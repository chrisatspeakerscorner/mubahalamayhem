<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=no, viewport-fit=cover">

  <title>Mubahala Mayhem! | Challenge Your Favourite Apologists To A Battle With Allah's Curse!</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: black;
    }

    #backgroundImage {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: url("background.png") center center no-repeat;
      background-size: cover; /* Default for desktop/landscape */
      background-color: black;
      z-index: 0;
    }

    #loadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 2;
      width: 100vw; /* default fallbacks */
      height: 100vh;
      pointer-events: none;
      padding: env(safe-area-inset-top, 20px) env(safe-area-inset-right, 20px) env(safe-area-inset-bottom, 20px) env(safe-area-inset-left, 20px);
      box-sizing: border-box;
    }

    #loadingText {
      margin-bottom: 20px;
      font-size: 1.2rem;
      text-shadow: 0 0 10px #000;
    }

    #loadingBar {
      width: 300px;
      height: 20px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 10px #000;
    }

    #loadingBarFill {
      height: 100%;
      width: 0%;
      background: #4CAF50;
      transition: width 0.2s ease;
    }

    #rotateMessage {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 999;
      color: white;
      font-size: 1.8rem;
      font-family: sans-serif;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
    }

    canvas {
      z-index: 1;
      position: relative;
    }
  </style>
</head>
<body style="text-align: center;">
  <div id="backgroundImage"></div>

  <div id="loadingOverlay">
    <div id="loadingText">Loading...</div>
    <div id="loadingBar">
      <div id="loadingBarFill"></div>
    </div>
  </div>

  <div id="rotateMessage">Please rotate your device to landscape to play.</div>

  <canvas id="unity-canvas" width={{{ WIDTH }}} height={{{ HEIGHT }}} tabindex="-1" style="width: {{{ WIDTH }}}px; height: {{{ HEIGHT }}}px; background: transparent;"></canvas>

  <script src="Build/{{{ LOADER_FILENAME }}}"></script>
  <script>
    // Detect and respond to orientation
    function checkOrientation() {
      const rotateMsg = document.getElementById("rotateMessage");
      const isPortrait = window.innerHeight > window.innerWidth;

      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 1;

      const isDefinitelyMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
      const isDefinitelyDesktop = /Win32|Win64|Macintosh|MacIntel|Linux x86_64/i.test(userAgent);

      const isMobile = isDefinitelyMobile || (isTouch && !isDefinitelyDesktop);

      if (isMobile && isPortrait) {
        rotateMsg.style.display = "flex";
      } else {
        rotateMsg.style.display = "none";
      }
    }


    function fixLayout() {
      const overlay = document.getElementById("loadingOverlay");

      // Use visualViewport for better mobile landscape accuracy
      const width = window.visualViewport?.width || window.innerWidth;
      const height = window.visualViewport?.height || window.innerHeight;

      overlay.style.display = "flex";
      overlay.style.width = width + "px";
      overlay.style.height = height + "px";
    }

    function reflowLayoutSafely() {
      // Delay layout updates slightly to ensure viewport has settled
      requestAnimationFrame(() => {
        fixLayout();

        // Some browsers (especially iOS Safari) need a second frame
        setTimeout(fixLayout, 100);
      });
    }

    // Listen for orientation changes or resizing
    window.addEventListener("load", reflowLayoutSafely);
    window.addEventListener("resize", reflowLayoutSafely);
    window.addEventListener("orientationchange", reflowLayoutSafely);

    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
      var meta = document.createElement('meta');
      meta.name = 'viewport';
      meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
      document.head.appendChild(meta);

      var canvas = document.querySelector("#unity-canvas");
      canvas.style.width = "100%";
      canvas.style.height = "100%";
      canvas.style.position = "fixed";

      document.body.style.textAlign = "left";
    }

    createUnityInstance(document.querySelector("#unity-canvas"), {
      arguments: [],
      dataUrl: "Build/{{{ DATA_FILENAME }}}",
      frameworkUrl: "Build/{{{ FRAMEWORK_FILENAME }}}",
#if USE_THREADS
      workerUrl: "Build/{{{ WORKER_FILENAME }}}",
#endif
#if USE_WASM
      codeUrl: "Build/{{{ CODE_FILENAME }}}",
#endif
#if SYMBOLS_FILENAME
      symbolsUrl: "Build/{{{ SYMBOLS_FILENAME }}}",
#endif
      streamingAssetsUrl: "StreamingAssets",
      companyName: {{{ JSON.stringify(COMPANY_NAME) }}},
      productName: {{{ JSON.stringify(PRODUCT_NAME) }}},
      productVersion: {{{ JSON.stringify(PRODUCT_VERSION) }}},
    }, function(progress) {
      document.getElementById("loadingBarFill").style.width = (progress * 100) + "%";
    }).then(function() {
      const overlay = document.getElementById("loadingOverlay");
      if (overlay) overlay.remove();
    });

  </script>
</body>
</html>
